This is from github with some changes
